<script>
paper.setup('canvas');

let centerCircle;

// --- DRAW CENTER CIRCLE ---
function drawCenteredCircle() {
    paper.project.clear();
    centerCircle = new paper.Path.Circle({
        center: paper.view.center,
        radius: 80,
        strokeColor: 'red',
        strokeWidth: 5
    });
}
drawCenteredCircle();

paper.view.onResize = function () {
    drawCenteredCircle();
};

// --- CLICK TO ADD DOT ---
paper.view.onMouseDown = function(event) {
    if (event.event.button === 0) { // left click
        new paper.Path.Circle({
            center: event.point,
            radius: 20,
            fillColor: 'cyan'
        });
    }
};

// ---------------------------
//       ZOOM FUNCTIONALITY
// ---------------------------
let zoomSpeed = 1.05;

document.addEventListener("wheel", function (e) {
    e.preventDefault();

    const oldZoom = paper.view.zoom;
    const mousePos = new paper.Point(e.clientX, e.clientY);
    const viewPos = paper.view.viewToProject(mousePos);

    // Zoom in or out
    const newZoom = e.deltaY < 0 ? oldZoom * zoomSpeed : oldZoom / zoomSpeed;
    paper.view.zoom = newZoom;

    // Keep the zoom centered on cursor
    const newViewPos = paper.view.viewToProject(mousePos);
    const offset = newViewPos.subtract(viewPos);
    paper.view.center = paper.view.center.add(offset);
}, { passive: false });

// ---------------------------
//         PAN (MIDDLE MOUSE)
// ---------------------------
let isPanning = false;
let panStart;

paper.view.onMouseDown = function (event) {
    if (event.event.button === 1) { // middle mouse
        isPanning = true;
        panStart = event.point;
    } else if (event.event.button === 0) {
        // Left-click create dots
        new paper.Path.Circle({
            center: event.point,
            radius: 20,
            fillColor: 'cyan'
        });
    }
};

paper.view.onMouseDrag = function (event) {
    if (isPanning) {
        const delta = panStart.subtract(event.point);
        paper.view.center = paper.view.center.add(delta);
    }
};

paper.view.onMouseUp = function () {
    isPanning = false;
};
</script>
