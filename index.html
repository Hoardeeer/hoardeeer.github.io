<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Org Tool</title>
    <style>
        /* 1. RESET & BASIC SETUP */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #1e1e1e;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            touch-action: none;
            
            /* CRITICAL: Force crisp rendering */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 2. BACKGROUND */
        .viewport {
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle at center, #2b2b2b 0%, #1a1a1a 100%);
            cursor: grab;
            position: relative;
            overflow: hidden;
        }

        .viewport:active {
            cursor: grabbing;
        }

        /* 3. THE WORLD CONTAINER - OPTIMIZED FOR QUALITY */
        #world {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            transform-origin: 0 0;
            will-change: transform;
            
            /* QUALITY FIXES */
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            transform-style: preserve-3d;
            -webkit-transform-style: preserve-3d;
            
            /* Force crisp rendering */
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        /* Apply crisp rendering to all children */
        #world * {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        /* 4. ORIGIN MARKERS */
        .origin-circle {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #ff5f56;
            border-radius: 50%;
            top: -10px;
            left: -10px;
            box-shadow: 0 0 15px rgba(255, 95, 86, 0.6);
            z-index: 10;
        }

        .grid-line {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.05);
            pointer-events: none;
        }
        
        .label {
            position: absolute;
            top: 15px;
            left: 15px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
            pointer-events: none;
            white-space: nowrap;
        }

        .ui-hint {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: #666;
            font-size: 14px;
            pointer-events: none;
            user-select: none;
        }
    </style>
</head>
<body>

    <div class="viewport" id="viewport">
        <div id="world">
            <div class="origin-circle"></div>
            <div class="label">Origin (0, 0)</div>
            <div class="grid-line" style="width: 2000px; height: 1px; top: 0; left: -1000px;"></div>
            <div class="grid-line" style="width: 1px; height: 2000px; top: -1000px; left: 0;"></div>
        </div>

        <div class="ui-hint">
            Desktop: Scroll & Drag <br>
            Mobile: Pinch & Drag
        </div>
    </div>

    <script>
        const viewport = document.getElementById('viewport');
        const world = document.getElementById('world');

        // --- STATE VARIABLES ---
        let scale = 1;
        let pointX = window.innerWidth / 2;
        let pointY = window.innerHeight / 2;
        
        // Mouse State
        let isPanning = false;
        let startX = 0, startY = 0;

        // Touch State
        let lastTouchDistance = 0;
        let lastCenter = { x: 0, y: 0 };

        // Apply initial position
        updateTransform();

        // ============================
        //     MOUSE EVENTS (DESKTOP)
        // ============================

        viewport.addEventListener('mousedown', (e) => {
            e.preventDefault();
            isPanning = true;
            startX = e.clientX - pointX;
            startY = e.clientY - pointY;
        });

        viewport.addEventListener('mousemove', (e) => {
            if (!isPanning) return;
            e.preventDefault();
            pointX = e.clientX - startX;
            pointY = e.clientY - startY;
            updateTransform();
        });

        viewport.addEventListener('mouseup', () => isPanning = false);
        viewport.addEventListener('mouseleave', () => isPanning = false);

        viewport.addEventListener('wheel', (e) => {
            e.preventDefault();
            const xs = (e.clientX - pointX) / scale;
            const ys = (e.clientY - pointY) / scale;
            const delta = -e.deltaY;

            let newScale = scale;
            (delta > 0) ? (newScale *= 1.1) : (newScale /= 1.1);
            
            // Apply constraints
            if (newScale < 0.1) newScale = 0.1;
            if (newScale > 50) newScale = 50;

            pointX = e.clientX - xs * newScale;
            pointY = e.clientY - ys * newScale;
            scale = newScale;

            updateTransform();
        }, { passive: false });


        // ============================
        //      TOUCH EVENTS (MOBILE)
        // ============================

        viewport.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
                isPanning = true;
                startX = e.touches[0].clientX - pointX;
                startY = e.touches[0].clientY - pointY;
            } else if (e.touches.length === 2) {
                isPanning = false;
                lastTouchDistance = getDistance(e.touches);
                lastCenter = getCenter(e.touches);
            }
        }, { passive: false });

        viewport.addEventListener('touchmove', (e) => {
            e.preventDefault();

            if (e.touches.length === 1 && isPanning) {
                // Simple Pan
                pointX = e.touches[0].clientX - startX;
                pointY = e.touches[0].clientY - startY;
                updateTransform();

            } else if (e.touches.length === 2) {
                // Pinch + Pan
                const currentDistance = getDistance(e.touches);
                const currentCenter = getCenter(e.touches);

                // Calculate scale change
                const distanceRatio = currentDistance / lastTouchDistance;
                let newScale = scale * distanceRatio;

                // Clamp scale
                if (newScale < 0.1) newScale = 0.1;
                if (newScale > 50) newScale = 50;

                // Calculate world coordinates
                const worldX = (lastCenter.x - pointX) / scale;
                const worldY = (lastCenter.y - pointY) / scale;

                // Apply new scale
                scale = newScale;

                // Reposition to keep the center point stable
                pointX = currentCenter.x - worldX * scale;
                pointY = currentCenter.y - worldY * scale;

                // Update for next frame
                lastTouchDistance = currentDistance;
                lastCenter = currentCenter;
                
                updateTransform();
            }
        }, { passive: false });

        viewport.addEventListener('touchend', (e) => {
            if (e.touches.length === 1) {
                isPanning = true;
                startX = e.touches[0].clientX - pointX;
                startY = e.touches[0].clientY - pointY;
            }
        });


        // ============================
        //        HELPER FUNCTIONS
        // ============================

        function updateTransform() {
            // Use translate3d for hardware acceleration and better quality
            // Round to nearest pixel to reduce sub-pixel rendering blur
            const x = Math.round(pointX * 100) / 100;
            const y = Math.round(pointY * 100) / 100;
            const s = Math.round(scale * 10000) / 10000;
            
            world.style.transform = `translate3d(${x}px, ${y}px, 0) scale(${s})`;
        }

        function getDistance(touches) {
            const dx = touches[0].clientX - touches[1].clientX;
            const dy = touches[0].clientY - touches[1].clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        function getCenter(touches) {
            return {
                x: (touches[0].clientX + touches[1].clientX) / 2,
                y: (touches[0].clientY + touches[1].clientY) / 2
            };
        }
    </script>
</body>
</html>
